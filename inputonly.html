<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ†ã‚­ã‚¹ãƒˆã‚¤ãƒ³ãƒ—ãƒƒã‚¿ãƒ¼ v2.1</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: black;
                color: white;
            }

            textarea {
                background-color: #333;
                color: white;
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0.4;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #message-container {
            text-align: center;
            max-width: 80%; /* æœ€å¤§å¹…ã‚’è¨­å®š */
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; /* ç›¸å¯¾é…ç½® */
        }

        #errorMessage{
            color: black;
            position: absolute;
            bottom: -20%; 
        }

        #errorMessage.error {
            color: red;
        }

        /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ–‡å­—ã‚µã‚¤ã‚ºã¨æ–‡å­—é–“éš”ã‚’èª¿æ•´ */
        textarea {
            font-size: 20px;
            letter-spacing: 2.5px; /* æ–‡å­—é–“éš”ã‚’èª¿æ•´ */
            width: 150%; /* å¹…ã‚’150%ã«è¨­å®š */
            margin-bottom: 10px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  */	
        }	

        /* é€ä¿¡å±¥æ­´ã®ã‚¹ã‚¿ã‚¤ãƒ« */	
        #history {	
            display: flex;	
            flex-direction: column-reverse; /* æœ€æ–°ã®å±¥æ­´ãŒä¸‹ã«æ¥ã‚‹ã‚ˆã†ã« */	
            max-height: 300px; /* æœ€å¤§ã®é«˜ã•ã‚’è¨­å®š */	
            overflow-y: auto; /* é«˜ã•ã‚’è¶…ãˆãŸå ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’è¡¨ç¤º */	
            scrollbar-width: thin;
            width: 150%; /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨åŒã˜å¹…ã«è¨­å®š */
            position: absolute; /* çµ¶å¯¾é…ç½® */
            bottom: 75%; /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸Šã«è¡¨ç¤º */
            z-index: 1; /* ä»–ã®è¦ç´ ã‚ˆã‚Šæ‰‹å‰ã«è¡¨ç¤º */
            margin-bottom: 10px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  */
        }

        #history::-webkit-scrollbar {
            width: 0; /* WebKitï¼ˆChromeã‚„Safariï¼‰ç”¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ */
        }

        .history-item {
            background-color: #333333e6; /* é€æ˜åº¦ã‚’è¨­å®š */
            padding: 5px;	
            margin-bottom: 6.5px;	
            border-radius: 5px;
            white-space: pre-line; 
            text-align: left;
            padding-left: 15px; 
        }

        .menubar{
            display: flex;
        }

        button {
            background-color: rgb(181, 181, 181);
            color: transparent; 
            text-shadow: 0 0 0 black;
            padding: 5px 10px 5px 10px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            margin: 0px 5px 0px 5px;
            font-size: 120%;
        }

        button:hover {
            transform: translateY(-3px); /* ãƒ›ãƒãƒ¼æ™‚ã«ã‚ãšã‹ã«æµ®ãã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        }

        #message-container.off #toggleLog, #togglePush.off, #toggleBack.off{
            background-color: #333;
            color: transparent; 
            text-shadow: 0 0 0 white;
        }

        #message-container.off #history{
            display: none;
        }
        #message-container.on h1{
            color: black;
        }

    </style>
</head>
<body>
    <div id="message-container" class="off">
        <h1>ãƒ†ã‚­ã‚¹ãƒˆã‚¤ãƒ³ãƒ—ãƒƒã‚¿ãƒ¼</h1>
        <div id="history"></div>
        <textarea id="inputText" rows="4" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
        <div class="menubar">
            <button title="Discordé€ä¿¡åˆ‡æ›¿" id="togglePush" onclick="togglePush()" class="on">ğŸ’¬</button>
            <button title="ãƒ­ã‚°è¡¨ç¤ºåˆ‡æ›¿" id="toggleLog" onclick="toggleLog()">ğŸ—’ï¸</button>
            <button title="ãƒ­ã‚°å‰Šé™¤" id="dust" onclick="showConfirmationDialog()">ğŸ—‘ï¸</button>
            <button title="ãƒ­ã‚°ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" id="download" onclick="downloadHistory()">ğŸ“©</button>
            <button title="ä¸€åŒºåˆ‡ã‚Šé€ä¿¡" id="diamond" onclick="sendDiamond()">â—†</button>
            <button title="BackSpaceæœ‰åŠ¹åŒ–" id="toggleBack" onclick="toggleBack()" class="on">âŒ«</button>
        </div>
        <br>
        <p id="errorMessage">BLANK</p>
    </div>

    <script>
        // Discord Webhookã®URLã‚’æŒ‡å®š
        const discordWebhookURL = 'WebhookURL';

        // é€ä¿¡å±¥æ­´ã‚’æ ¼ç´ã™ã‚‹é…åˆ—
        const history = [];

        let isPushButtonOn = localStorage.getItem('isPushButtonOn') === 'true';
        function togglePush() {
            const togglePush = document.getElementById('togglePush');
            isPushButtonOn = !isPushButtonOn;
            togglePush.classList.toggle('on', isPushButtonOn);
            togglePush.classList.toggle('off', !isPushButtonOn);
            localStorage.setItem('isPushButtonOn', isPushButtonOn);
        }

        let isLogButtonOn = localStorage.getItem('isLogButtonOn') === 'true';
        function toggleLog() {
            const messageContainer = document.getElementById('message-container');
            isLogButtonOn = !isLogButtonOn;
            messageContainer.classList.toggle('on', isLogButtonOn);
            messageContainer.classList.toggle('off', !isLogButtonOn);
            localStorage.setItem('isLogButtonOn', isLogButtonOn);
        }

        let isBackButtonOn = localStorage.getItem('isBackButtonOn') === 'true';
        function toggleBack() {
            const toggleBack = document.getElementById('toggleBack');
            isBackButtonOn = !isBackButtonOn;
            toggleBack.classList.toggle('on', isBackButtonOn);
            toggleBack.classList.toggle('off', !isBackButtonOn);
            localStorage.setItem('isBackButtonOn', isBackButtonOn);
        }

        // é€ä¿¡å±¥æ­´ã‚’LocalStorageã«ä¿å­˜
        function saveHistoryToCache() {
            localStorage.setItem('history', JSON.stringify(history));
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å±¥æ­´ã‚’LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿
        function loadHistoryFromCache() {
            const cachedHistory = localStorage.getItem('history');
            if (cachedHistory) {
                history.length = 0; // å±¥æ­´ã‚’ã‚¯ãƒªã‚¢
                history.push(...JSON.parse(cachedHistory)); // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å±¥æ­´ã‚’èª­ã¿è¾¼ã¿
                updateHistory(); // å±¥æ­´ã‚’è¡¨ç¤º
            }
        }

        function showConfirmationDialog() {
            const confirmation = confirm("æœ¬å½“ã«å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ");

            if (confirmation) {
                resetHistory();
            }
        }

        function resetHistory(){
            history.length = 0;
            updateHistory(); // å±¥æ­´ã‚’è¡¨ç¤º
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’åæ˜ 
        window.onload = function () {
            loadHistoryFromCache();

            const togglePush = document.getElementById('togglePush');
            togglePush.classList.toggle('on', isPushButtonOn);
            togglePush.classList.toggle('off', !isPushButtonOn);

            const messageContainer = document.getElementById('message-container');
            messageContainer.classList.toggle('on', isLogButtonOn);
            messageContainer.classList.toggle('off', !isLogButtonOn);

            const toggleBack = document.getElementById('toggleBack');
            toggleBack.classList.toggle('on', isBackButtonOn);
            toggleBack.classList.toggle('off', !isBackButtonOn);
        };

        function sendMessage() {
            const message = document.getElementById('inputText').value;
            document.getElementById('inputText').value = '';
            clearError();

            if (message) {
                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Discordã¸é€ä¿¡
                if(isPushButtonOn){
                    sendToDiscord(message);
                }
                // é€ä¿¡å±¥æ­´ã«è¿½åŠ 
                addToHistory(message);
            } else {
                showError('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        function sendToDiscord(message) {
            // ã“ã“ã«Webhooké€ä¿¡ã®JavaScriptã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¿°
            // ä¾‹: fetchãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦Discord Webhookã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
            fetch(discordWebhookURL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ content: message }),
            })
            .then(response => {
                if (response.ok) {
                    console.log('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸã€‚');
                } else {
                    showError('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
            })
            .catch(error => {
                showError('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error);
            });
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorMessage').classList.add('error');
        }

        function clearError() {
            document.getElementById('errorMessage').classList.remove('error');
        }

        // é€ä¿¡å±¥æ­´ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        function addToHistory(message) {
            history.unshift(message); // é…åˆ—ã®å…ˆé ­ã«è¿½åŠ 
            updateHistory();
        }

        // é€ä¿¡å±¥æ­´ã‚’æ›´æ–°ã—ã¦è¡¨ç¤º
        function updateHistory() {
            const historyContainer = document.getElementById('history');
            historyContainer.innerHTML = ''; // å±¥æ­´ã‚’ã‚¯ãƒªã‚¢

            // å±¥æ­´ã®è¦ç´ ã‚’ä½œæˆã—ã¦è¡¨ç¤º
            history.forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.classList.add('history-item');
                historyItem.textContent = item;
                historyContainer.appendChild(historyItem);
                historyItem.style.animation = 'fade-in 0.2s ease-out ' + (index * 0.05) + 's forwards';
            });

            // é€ä¿¡å±¥æ­´ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
            saveHistoryToCache();
        }

        // Enterã‚­ãƒ¼ã§é€ä¿¡
        document.getElementById('inputText').addEventListener('keydown', function (e) {
            if(!isBackButtonOn){
                if(e.key === "Backspace" || e.keyCode === 8) {
                    //ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å…¥åŠ›ã—ãŸæ–‡å­—ã‚’æ¶ˆã›ã¾ã›ã‚“
                    e.preventDefault();
                    return false;
                }
            }
            if (e.isComposing || e.key === 'Process' || e.keyCode === 229) {
                // IMEå…¥åŠ›ä¸­
            } else {
                // IMEå…¥åŠ›ä¸­ã§ãªã„
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            }
        });

        function downloadHistory() {
            const currentDate = new Date();
            const formattedDate = `${(currentDate.getFullYear() % 100).toString().padStart(2, '0')}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')}`;
            const historyText = history.reverse().join('\n\n'); // å±¥æ­´ã‚’æ”¹è¡Œã§çµåˆ
            const blob = new Blob([historyText], { type: 'text/plain' });
            const fileName = `history-${formattedDate}.txt`;
        
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            history.reverse();
        }

        function sendDiamond(){
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Discordã¸é€ä¿¡
            if(isPushButtonOn){
                sendToDiscord("â€•â€•â€•â€•â€•â€•â€•â€•");
            }
            // é€ä¿¡å±¥æ­´ã«è¿½åŠ 
            addToHistory("ã€€ã€€ã€€ã€€â—†");
        }
    </script>
</body>
</html>
